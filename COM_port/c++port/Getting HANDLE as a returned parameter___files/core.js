var Forums={};Forums.Constants={ExpandCollapseImage:'<img src="'+ForumsRes.url_transGif+'" class="expcol"/>',ExpandCollapseLink:'<a class="expcol" href="javascript:void(0);"/>',ExpandCollapseImageRef:"img.expcol",ExpandCollapseLinkRef:"a.expcol"};Forums.Rte={IsOpen:false,IsReady:false,canShow:function(a){if(Forums.Rte.IsOpen===false)return true;a===true&&alert(ForumsRes.rte_alreadyOpen);return false},show:function(a){if(Forums.Rte.IsOpen===true)return false;tinyMCE.execCommand("mceAddControl",true,a);setTimeout(function(){Forums.Rte.IsReady=true},ForumsRes.rte_readyDelay);Forums.Rte.IsOpen=true;return true},hide:function(a){tinyMCE.execCommand("mceRemoveControl",false,a);Forums.Rte.IsOpen=false;Forums.Rte.IsReady=false},get_text:function(a){return tinyMCE.get(a).getContent()},set_text:function(a,b){if(Forums.Rte.IsReady)tinyMCE.get(a).setContent(b);else setTimeout(function(){tinyMCE.get(a).setContent(b)},100)},show_busy:function(a,b){tinyMCE.get(a).setProgressState(b)},customInitInstance:function(a){a.focus();a.execCommand("selectall",false);a.selection.collapse(false)}};Forums.Filters={decorateFilters:function(){var a=$(this);$("h6",this).prepend(Forums.Constants.ExpandCollapseLink);$("h6",this).click(function(){$(a).children("div.content").children("div.advanced").slideToggle("fast");$(a).toggleClass("expanded")});$("h6",this).mouseover(function(){$(a).addClass("hover")});$("h6",this).mouseout(function(){$(a).removeClass("hover")});$("div.advanced li a",this).hasClass("selected")&&$("h6",this).click()}};Forums.Message={autoSubscribeValue:function(d){var a=false;try{a=pageData.autoSubscribe;if(!a){var b=$(d).parents("li.thread");if(b!=null&&b.length>0){if($("h3 > img",b).hasClass("alert"))a=true}else{var c=$("ul.thread.menu > li > a[name='unsubscribe']");if(c!=null&&c.length>0)a=true}}}catch(e){}return a?"checked='checked'":""},edit:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var b=$(a).attr("id")+"_editor",c=$("div.body",a),d=$("#"+$(a).attr("id")+"_attachments").attr("value");$(c).hide();$("div.helpful, ul.history, div.abusive, div.menu, div.votingouterbox, div.voting,span.votinglabel",a).hide();var e="<div class='editor'><form><textarea class='rte' id='"+b+"'></textarea><input type='hidden' name='attachmentIds' value='"+d+"'/></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>&nbsp;<label>"+ForumsRes.rte_reasonLabel+"</label><input type='text' name='reason'/></div></div>";$(c).after(e);$("#"+b,a).text($(c).html()+"<br/>");Forums.Rte.show(b);$("button[name='submit']",a).click(Forums.Message.submitEdit(a,$(this).attr("href")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide(b);$("div.editor",a).remove();$(c).show();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).show()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},reply:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var c=$(a).attr("id")+"_editor",b="<div class='editor'><form><textarea class='rte' id='"+c+"'></textarea><input type='hidden' name='attachmentIds'/></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>";if(userEmailConfigured)b=b+"&nbsp;<input type='checkbox' name='subscribe' "+Forums.Message.autoSubscribeValue(a)+"/><label>"+ForumsRes.rte_subscribeText+"</label>";b=b+"</div></div>";$(a).append(b);Forums.Rte.show(c);$("button[name='submit']",a).click(Forums.Message.submitReply(a,$(this).attr("href")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide(c);$("div.editor",a).remove()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},quote:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var c=$(a).attr("id")+"_editor",d=$("div.body",a),f=$("div.helpful",a),b="<div class='editor'><form><textarea class='rte' id='"+c+"'></textarea><input type='hidden' name='attachmentIds' value='' /></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>";if(userEmailConfigured)b=b+"&nbsp;<input type='checkbox' name='subscribe' "+Forums.Message.autoSubscribeValue(a)+"/><label>"+ForumsRes.rte_subscribeText+"</label>";b=b+"</div></div>";$(a).append(b);var e="<blockquote>"+$(d).html()+"</blockquote><br/>";$("#"+c,a).text(e);Forums.Rte.show(c);$("button[name='submit']",a).click(Forums.Message.submitReply(a,$(this).attr("href")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide(c);$("div.editor",a).remove()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},submitEdit:function(a,b){return function(){$("div.editor button",a).attr("disabled","disabled");var c=$(a).attr("id")+"_editor",f=Forums.Rte.get_text(c),e=$("div.editor > div.commands > input[name='reason']",a).val(),d=$("div.editor input[name='attachmentIds']",a).attr("value");Forums.Rte.show_busy(c,true);$.ajax({type:"POST",url:b,data:{body:f,reason:e,attachmentIds:d},success:function(b){Forums.Rte.hide(c);$("div.editor",a).remove();$(a).after(b).next().hide().fadeIn("fast").each(Forums.Message.decorateMessage);$(a).remove()},error:function(b){Forums.Rte.show_busy(c,false);$("div.editor button",a).removeAttr("disabled");alert(b.responseText)}})}},submitReply:function(a,b){return function(){var c=$(a).attr("id")+"_editor";$("div.editor button",a).attr("disabled","disabled");var f=Forums.Rte.get_text(c),d=$("div.editor input[name='attachmentIds']",a).attr("value");Forums.Rte.show_busy(c,true);var e=$("div.editor > div.commands > input[name='subscribe']",a).attr("checked")=="checked";$.ajax({type:"POST",url:b,data:{body:f,attachmentIds:d,subscribe:e},success:function(b){Forums.Rte.hide(c);$("div.editor",a).remove();$(a).after(b).next().hide().fadeIn("fast").addClass("new").each(Forums.Message.decorateMessage)},error:function(b){Forums.Rte.show_busy(c,false);$("div.editor button",a).removeAttr("disabled");alert(b.responseText)}})}},messageAction:function(a,b){return function(){var c=$(a).parents("li.message"),d=$(c).attr("id");$(c).append('<div class="submitting"></div>');$(c).addClass("submitting");$.ajax({type:"POST",url:$(a).attr("href"),data:b,success:function(a){$(c).replaceWith(a);$("li.message[id='"+d+"']").each(Forums.Message.decorateMessage)},error:function(a){$("div.submitting",c).remove();alert(a.responseText)}});return false}},promptAction:function(a,c,b){return function(){Forums.HTML.createPopup(c);$("#okButton").click(function(){b.reason=$("#reason").attr("value");Forums.Message.messageAction(a,b)();var c=$(a).parents("li.message");$(".menu.message",c).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#reason").keypress(function(a){a.which==13&&$("#okButton").click()});$("#cancelButton").click(function(){var b=$(a).parents("li.message");$(".menu.message",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#closeButton").click(function(){var b=$(a).parents("li.message");$(".menu.message",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});return false}},answer:function(){$(this).click(Forums.Message.messageAction($(this),{isAnswer:true}))},unanswer:function(){$(this).click(Forums.Message.messageAction($(this),{isAnswer:false}))},proposeAnswer:function(){$(this).click(Forums.Message.messageAction($(this),{isProposed:true}))},unproposeAnswer:function(){$(this).click(Forums.Message.messageAction($(this),{isProposed:false}))},clearAbuse:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_clearAbuseReason,{isAbuse:false}))},reportAbuse:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_reportAbuseReason,{isAbuse:true}))},deleteMessage:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_deleteReason,{isDeleted:true}))},undeleteMessage:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_undeleteReason,{isDeleted:false}))},voteHelpful:function(){var a=$(this);$(this).click(function(){$(a).fadeOut("fast");var b=$(a).parents("li.message");$("div.helpful > span > img",b).addClass("submitting");$.ajax({type:"POST",url:$(a).attr("href"),data:{isHelpful:true},dataType:"json",success:function(a){$("div.helpful > span > span",b).text(a.Votes);$("div.helpful > span > img",b).removeClass("submitting")},error:function(a){$("div.helpful > span > img",b).removeClass("submitting");alert(a.responseText)}});return false})},voteUp:function(){$(this).click(Forums.Message.messageAction($(this),{isHelpful:true}))},voteDown:function(){$(this).click(Forums.Message.messageAction($(this),{isHelpful:false}))},decorateMessage:function(){if(typeof pageData=="undefined"||pageData==null||pageData.validUser==false)return;$("a[name='reportAbuse']",this).each(Forums.Message.reportAbuse);$("a[name='clearAbuse']",this).each(Forums.Message.clearAbuse);$("div.helpful a.vote",this).each(Forums.Message.voteHelpful);$("a[name='voteup']",this).each(Forums.Message.voteUp);$("a[name='votedown']",this).each(Forums.Message.voteDown);var a=$("div.menu.message",this);$("a[name='setAnswer']",a).each(Forums.Message.answer);$("a[name='unsetAnswer']",a).each(Forums.Message.unanswer);$("a[name='proposeAnswer']",a).each(Forums.Message.proposeAnswer);$("a[name='unproposeAnswer']",a).each(Forums.Message.unproposeAnswer);$("a[name='reply']",a).each(Forums.Message.reply);$("a[name='quote']",a).each(Forums.Message.quote);$("a[name='edit']",a).each(Forums.Message.edit);$("a[name='delete']",a).each(Forums.Message.deleteMessage);$("a[name='undelete']",a).each(Forums.Message.undeleteMessage)}};Forums.HTML={createPopup:function(e){if($("#boxes").length>0){$("#mask").remove();$("#dialog").remove();$("#boxes").remove()}var d="<div id='boxes'><div id='dialog' class='window'><div class='poupTitle'><label id='resonLabel'>"+e+"</label><img title='Close' id='closeButton' class='icon delete' src=\""+ForumsRes.url_transGif+"\" complete='complete' ></img></div><div style='padding:0px 5px 10px 5px;'><span class='textSpan'><input type='text' id='reason' name='reason' value='' /></span><span class='buttonSpan'><button id='okButton' name='ok' >"+ForumsRes.rte_OKText+"</button><button id='cancelButton' name='cancel' > "+ForumsRes.rte_cancelText+"</button></span></div></div><div id='mask'></div></div>";$("body").append(d);var a="#dialog",c="#mask";$("#reason").select();$("#reason").focus();var f=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:f,left:b>0?b:0,display:"block"});this.addAnimation(a);$(c).css({top:0,left:0,width:$(document).width(),height:$(document).height()});$(c).fadeTo("fast",.5)},addAnimation:function(a){$(window).resize(function(){var c=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:c,left:b>0?b:0})});$(window).scroll(function(){var c=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:c,left:b>0?b:0})})}};Forums.Thread={threadAction:function(a,b){return function(){$("img.icon",a).addClass("submitting");$.ajax({type:"POST",url:$(a).attr("href"),data:b,dataType:"json",success:function(a){window.location=a.url},error:function(b){$("img.icon",a).removeClass("submitting");alert(b.responseText)}});return false}},promptAction:function(a,c,b){return function(){Forums.HTML.createPopup(c);$("#okButton").click(function(){b.reason=$("#reason").attr("value");Forums.Thread.threadAction(a,b)();var c=$(a).parents("li.message.root");$("ul.menu.thread",c).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#reason").keypress(function(a){a.which==13&&$("#okButton").click()});$("#cancelButton").click(function(){var b=$(a).parents("li.message.root");$("ul.menu.thread",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#closeButton").click(function(){var b=$(a).parents("li.message.root");$("ul.menu.thread",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});return false}},editThread:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var b=$(a).attr("id")+"_editor",f=$("#content > h1 > span[name='subject']").text(),c=$("div.body",a),d=$("#"+$(a).attr("id")+"_attachments").attr("value");$(c).hide();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).hide();var e="<div class='editor'><label>"+ForumsRes.rte_subjectLabel+"</label> <input type='text' id='subject' size='60' /><form><textarea class='rte' id='"+b+"'></textarea><input type='hidden' name='attachmentIds' value='"+d+"'/></form><div class='commands'><button id='submit'>"+ForumsRes.rte_submitText+"</button><button id='cancel'>"+ForumsRes.rte_cancelText+"</button>&nbsp;<label>"+ForumsRes.rte_reasonLabel+"</label><input type='text' id='reason'/></div></div>";$(c).after(e);$("#subject",a).val(f);$("#"+b,a).text($(c).html()+"<br/>");Forums.Rte.show(b);$("#submit",a).click(Forums.Thread.submitEdit(a,$(this).attr("href")));$("#cancel",a).click(function(){Forums.Rte.hide(b);$("div.editor",a).remove();$(c).show();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).show()});$("#submit",a).get(0).scrollIntoView(false);return false})},submitEdit:function(a,b){return function(){var d=$("div.editor");d.find("button").attr("disabled","disabled");var c=$(a).attr("id")+"_editor",h=Forums.Rte.get_text(c),g=d.find("#reason").val(),f=d.find("#subject").val(),e=$("div.editor input[name='attachmentIds']",a).attr("value");Forums.Rte.show_busy(c,true);$.ajax({type:"POST",url:b,data:{subject:f,body:h,reason:g,attachmentIds:e},dataType:"json",success:function(b){Forums.Rte.hide(c);$("div.editor",a).remove();window.location=b.url},error:function(b){Forums.Rte.show_busy(c,false);$("div.editor button",a).removeAttr("disabled");alert(b.responseText)}})}},clearSticky:function(){$(this).click(Forums.Thread.threadAction(this,{stickyDate:""}))},deleteThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_deleteReason,{isDeleted:true}))},deescalateThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_deEscalateReason,{isEscalated:false}))},escalateThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_escalateReason,{isEscalated:true}))},lock:function(){$(this).click(Forums.Thread.threadAction(this,{isLocked:true}))},makeSticky:function(){var a=$(this);$(this).click(function(){var b=prompt(ForumsRes.prompt_stickyUntil,"");b!==null&&Forums.Thread.threadAction(a,{stickyDate:b})();return false})},subscribe:function(){$(this).click(Forums.Thread.threadAction(this,{isSubscribed:true}))},undeleteThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_undeleteReason,{isDeleted:false}))},unlock:function(){$(this).click(Forums.Thread.threadAction(this,{isLocked:false}))},unsubscribe:function(){$(this).click(Forums.Thread.threadAction(this,{isSubscribed:false}))},join:function(){$(this).click(Forums.Thread.threadAction($(this),{isJoined:true}))},unjoin:function(){$(this).click(Forums.Thread.threadAction($(this),{isJoined:false}))},decorateThreadMenu:function(){$("a[name='delete']",this).each(Forums.Thread.deleteThread);$("a[name='undelete']",this).each(Forums.Thread.undeleteThread);$("a[name='editThread']",this).each(Forums.Thread.editThread);$("a[name='lock']",this).each(Forums.Thread.lock);$("a[name='unlock']",this).each(Forums.Thread.unlock);$("a[name='sticky']",this).each(Forums.Thread.makeSticky);$("a[name='clearSticky']",this).each(Forums.Thread.clearSticky);$("a[name='subscribe']",this).each(Forums.Thread.subscribe);$("a[name='unsubscribe']",this).each(Forums.Thread.unsubscribe);$("a[name='escalate']",this).each(Forums.Thread.escalateThread);$("a[name='deEscalate']",this).each(Forums.Thread.deescalateThread);$("a[name='joinQuestion']").each(Forums.Thread.join);$("a[name='unJoinQuestion']").each(Forums.Thread.unjoin)},messagesLoaded:function(a){$(a).removeClass("loading");$(a).removeClass("hasUnread");$(a).removeClass("new");$(a).addClass("loaded");$(a).addClass("viewed");$("div.preview",a).append('<div class="links"></div>');var b=$("div.links",a);$(b).append('<a name="view"></a>');var e=$("a[name='view']",b),d=$("h3 a:eq(1)",a).attr("href");$(e).text(ForumsRes.thread_viewThreadText).attr("href",d).attr("title",ForumsRes.thread_viewThreadText);$(b).append('<a name="close"></a>');var c=$("a[name='close']",b);$(c).text(ForumsRes.thread_closePreviewText).attr("href","javascript:void(0)").attr("title",ForumsRes.thread_closePreviewText);$(c).click(function(){$("h3",a).click()});$("div.preview",a).slideToggle("fast");$("li.message",a).each(Forums.Message.decorateMessage)},decorateThread:function(){var a=$(this);$("h3 > a",this).before(Forums.Constants.ExpandCollapseLink);$(this).append('<div class="preview"></div>');$("h3",this).click(function(c){if(c.target.nodeName.toLowerCase()==="a")if(c.target.className!=="expcol")return;$(a).toggleClass("expanded");if($(a).hasClass("loading"))return;if($(a).hasClass("loaded")){$("div.editor button[name='cancel']",a).click();$("div.preview",a).slideToggle("fast");return}$(a).addClass("loading");var b=$("h3:first > a:eq(1)",a).attr("href")+"/messages";b=b.substring(7);b=b.substring(b.indexOf("/"));$("div.preview",a).load(b,null,function(){Forums.Thread.messagesLoaded(a);$("li.message",this).profileWidgitize()})});$("h3",this).mouseover(function(){$(a).addClass("hover")});$("h3",this).mouseout(function(){$(a).removeClass("hover")})}};Forums.Leaderboards={total:0,current:0,init:function(){Forums.Leaderboards.total=$(".box",this).length;if(Forums.Leaderboards.total>0){var a=".box:eq("+Forums.Leaderboards.current+")";$(a,this).show();setTimeout(Forums.Leaderboards.next,15000)}},next:function(){var b=$("#rail div.leaderboards"),a=".box:eq("+Forums.Leaderboards.current+")";$(a,b).hide();Forums.Leaderboards.current+=1;if(Forums.Leaderboards.current>=Forums.Leaderboards.total)Forums.Leaderboards.current=0;a=".box:eq("+Forums.Leaderboards.current+")";$(a,b).show();setTimeout(Forums.Leaderboards.next,15000)}};Forums.Users={usersAction:function(a,b){return function(){$("img.icon",a).addClass("submitting");$.post($(a).attr("href"),b,function(){$(a).remove()},"json");return false}},blockAvatar:function(){var a=$(this);$(this).click(Forums.Users.usersAction(a,{blockAvatar:true}))},unblockAvatar:function(){var a=$(this);$(this).click(Forums.Users.usersAction(a,{blockAvatar:false}))},decorateUsers:function(){$("a[name='blockUnblockAvatar']",this).each(Forums.Users.blockAvatar)}};$.addToRail=function(b,d){for(var e=$("#rail"),a=0;a<b.length;a++){var c=document.createElement("div");e.append(c);var f=b[a].indexOf("?")!=-1?"&":"?";$(c).load(b[a]+f+"rnd="+Math.random(),null,d)}};$.fn.popup=function(){$(this).each(function(){var b="a[name='"+$(this).attr("name")+"']",a="ul[name='"+$(this).attr("name")+"Popup']",c=$(a).width();$(this).find(Forums.Constants.ExpandCollapseImageRef).detach();$(this).append(Forums.Constants.ExpandCollapseImage);var d=function(){$("ul.popup").hide();$("body").unbind("click.popup")};$(this).click(function(f){$("ul.popup").hide();var e=$(b).position();if($(a).attr("popupAlign")==="right")$(a).css("left",e.left+$(f.target).width()/2-c);else if($(a).attr("popupAlign")==="rightRail")$(a).css("right",$(b).offsetParent().width()-e.left);else $(a).css("left",e.left);$(a).css("top",e.top+$(f.target).height()*1.5);$(a).show();f.stopPropagation();$("body").bind("click.popup",d)})})};Forums.ManageRoles={selectAll:function(){if($("#selectAll").attr("checked"))$("input[name='userId']").attr("checked","checked");else $("input[name='userId']").attr("checked",false)}};$.fn.removeWatermark=function(){$(this).each(function(){if($(this).hasClass("watermark")){$(this).val("");$(this).removeClass("watermark")}})};$.removeAllWatermarks=function(){$(".watermark").each(function(){$(this).removeWatermark()})};$.fn.watermark=function(a){$(this).each(function(){$(this).removeWatermark();$(this).bind("click",function(){if($(this).hasClass("watermark")){$(this).val("");$(this).removeClass("watermark")}});$(this).bind("blur",function(){if($(this).val()==""||$(this).val()==a){$(this).addClass("watermark");$(this).val(a)}});$(this).blur()})};$.fn.watermarkVal=function(){return $(this).hasClass("watermark")?"":$(this).val()};$(function(){$.addToRail(["/forums/"+window.fms_site_culture+"/Notifier"]);$(document).ajaxComplete(function(){$("a.popup").popup()})});$("input#ErrorSearchButton").live("click",function(){var b=$("input#ErrorSearchBox").val();if(!b)return;var a=$("input#SearchUri").val();if(!a)return;window.location.href=a.replace("{0}",escape(b))});